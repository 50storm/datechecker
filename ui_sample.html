<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<base target=main>

<script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
<link rel="stylesheet" href="/resources/demos/style.css" />
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />

<title>日付入力サンプル</title>
</head>
<script>

//日付データ格納用
//プロトタイプ　ベース　オブジェクト指向
//http://www.dab.hi-ho.ne.jp/sasa/biboroku/javascript/prototype.html
function PrtDate(){
	this.year;
	this.month;
	this.day;
};
PrtDate.prototype.show = function(){
	alert("year:" + this.year + "month:" + this.month + "day:" + this.day);
	
}
//function PrtDate(){
//	PrtDate.prototype.year;
//	PrtDate.prototype.month;
//	PrtDate.prototype.day;
//	PrtDate.prototype.show = function(){
//		alert("year:" + this.year + "month:" + this.month + "day:" + this.day);
//		
//	}
//};



//9999/99/99 or 9999-99-99 の型チェック 
function IsDateType(dateVal){
//http://www.megasoft.co.jp/mifes/seiki/
	var validatePattern = /^(\d{4})(\/|-)(\d{1,2})(\/|-)(\d{1,2})$/;
	return validatePattern.test(dateVal);//True or False
}

//現在日付をを設定
function getCurrentDate(){
	now = new Date();
	y = now.getFullYear();
	m = now.getMonth() + 1;
	d = now.getDate();
	// 時を取得
	//h = now.getHours();
	// 分を取得
	//i = now.getMinutes();
	// 秒を取得
	//s = now.getSeconds();
	//alert(y + '年' + m + '月' + d + '日 ' + h + '時' + i + '分' + s + '秒');
	return (y + '/' + m + '/' + d);
}

function validateYearFromTo(dateFrom, dateTo){
	var yearFrom, yearTo;
	yearFrom = dateFrom.substr(0,4);
	yearTo   = dateTo.substr(0,4);
	
	if(yearFrom > yearTo){
		return false;
	}else{
		return true;
	}
}

function validateMonthFromTo(dateFrom, dateTo){
	var monthFrom=[], monthTo=[];
	monthFrom = dateFrom.split("/", 2);
	monthTo   = dateTo.split("/", 2 );
	//1=>01 , 2=>02
	if(monthFrom[1].length==1){
		monthFrom[1] = "0" + monthFrom[1];
	}
	
	if(monthTo[1].length==1){
		monthTo[1] = "0" + monthTo[1];
	}
	
	if(monthFrom[1] > monthTo[1]){
		return false;
	}else{
		return true;
	}
}

function validateDayFromTo(dateFrom, dateTo){
	var dayFrom=[], dayTo=[];
	dayFrom = dateFrom.split("/", 3 );
	dayTo   = dateTo.split("/", 3 );
	
	if(dayFrom[2] > dayTo[2]){
		return false;
	}else{
		return true;
	}
}

function isLeapYear(dateVal){
	var arrDate=[];
	arrDate = dateVal.split("/", 3 );
	dateVal = arrDate[2];
	
	//100で割り切る　かつ　400で割り切れる　=> Leap Year
	
	//
	//4で割り切れる年は閏年である。ただし100で割り切れる年は閏年ではない。ただし400で割り切れる年は閏年
	//ただし100で割り切れる年は閏年ではない。
	//ただし400で割り切れる年は閏年
	if ( dateVal % 4 === 0){
		//4で割り切れる
		
		if(dateVal % 100 === 0 ){
		//100で割り切れる
			return false;
		}else{
		
			return true;
		}		
	}else{
		return false;
	}
	
	if ( dateVal % 400 === 0){
		return true;
	}else{
		return false;	
	}
	
	
	

}

$(function() {
	
	var objFromDate = new PrtDate();
	var objToDate = new PrtDate();
	
	//var objFromDate = new PrtDate();
	//var objToDate = new PrtDate();
	//
	//var arr = [];
	//arr = getCurrentDate().split("/",3);
	//objFromDate.year  = arr[0];
	//objFromDate.month = arr[1];
	//objFromDate.day   = arr[2];
	//objFromDate.show();
    //
    //
	//objToDate.year  = "2013";
	//objToDate.month = "1";
	//objToDate.day   = "12";
	//objToDate.show();

	//HTMLの初期値を設定
	//alert(getCurrentDate());
	$("input[name=txtShipFrom]").val(getCurrentDate());
	$("input[name=txtShipTo]").val(getCurrentDate());
	$("select[name=cmbYear]").val("2016");
	//focusの初期設定
	$("input[name=cmdFind]").focus();
	
	
	//jQuery UIのdatepickerを設定
	$("input[name=txtShipFrom]").datepicker({
		dateFormat: 'yy/mm/dd'
	});
	$("input[name=txtShipTo]").datepicker({
		dateFormat: 'yy/mm/dd'
	});
	$("input[name=cmdFind]").on('click', function(){
		//validation
		//http://webrewrite.com/validate-date-format-yyyymmdd-javascript/
		
		//validation
		//YearFrom
		var dateFrom = $("input[name=txtShipFrom]").val();
		var dateTo = $("input[name=txtShipTo]").val();
		
		
		if(!IsDateType(dateFrom)){
			//alert("日付は、9999/99/99ですよ");
			$("#msg").text("日付[From]は、9999/99/99で入力してください。");
			$("#msg").css("background-color","white").css("color","red");
			$("input[name=txtShipFrom]").css("background-color","red");
			//$("input[name=txtShipFrom]").append("<div>aaaaaaaaaaaaa</div>");
			return false;	
		}else{
			$("#msg").text("");
			
		}
		
		//YearTo
		if(!IsDateType(dateTo)){
			//alert("日付は、9999/99/99ですよ");
			$("#msg").text("日付[From]は、9999/99/99で入力してください。");
			$("#msg").css("background-color","white").css("color","red");
			$("input[name=txtShipTo]").css("background-color","red");
			//$("input[name=txtShipFrom]").append("<div>aaaaaaaaaaaaa</div>");
			return false;	
		}else{
			$("#msg").text("");
		}
		
		//日付FromToチェック
		//年の大小
		//9999/99/月で
		if(!validateYearFromTo(dateFrom, dateTo)){
			//alert("From>To Year");
			$("#msg").text("日付[年]がFrom>Toになっています。");
			$("#msg").css("background-color","white").css("color","red");
			return false;
		}else{
			$("#msg").text("");
		
		}
		//月の大小
		if(!validateMonthFromTo(dateFrom, dateTo)){
			$("#msg").text("日付[月]がFrom>Toになっています。");
			$("#msg").css("background-color","white").css("color","red");
			return false;
		}else{
			$("#msg").text("");
		}
		//日の大小
		if(!validateDayFromTo(dateFrom, dateTo)){
			$("#msg").text("日付[日]がFrom>Toになっています。");
			$("#msg").css("background-color","white").css("color","red");
			return false;
		}else{
			$("#msg").text("");
		}


		var tmpDay =[];
		if(!isLeapYear(dateFrom)) 
		{
			//うるう年でないので2/29になってないかチェック
			//alert("Leap Year")
			
			tmpDay = dateFrom.split("/" ,  3)
			if ( tmpDay[2] == 29 ){
				alert("2/29 is not correct");
			}
			
		}
		if(!isLeapYear(dateTo))
		{
			alert("Leap Year")
		}		
		
		
		//Ok
		$(this).val("ボタン押しました！");
		$(this).css("background-color","#FFFF00");
		$(this).prop("disabled", true);

		
		
	});
 });
 
</script>
<style>
    .ui-datepicker {
        font-size: 50%;
    }
	#msg{
	/*
		width:150px;
	*/
	}
	.fontcolor{
			color:white;
	}
	.center{
		text-align:center;
	}
	.body-background-color{
		background-color:#006699
	}
</style>
<body class="body-background-color">

<form method=GET action="make_qc_qty_insreports.cgi">

<!--
<form method=GET action="">
-->

	<h3 class="fontcolor center">データ入力</h3>
	<p  class="fontcolor center">入力日付</p>
    <p  class="fontcolor center">
		<input type=text name=txtShipFrom size=20><br>
		(例) 2004/01/01
	</p>      
    <p  class="fontcolor center"><input type=text name=txtShipTo size=20>
		<br>(例) 2004/01/01
	</p>     
    <p  class="center"　>
	<select size="1" name="cmbYear">
      <option value="2004">2004</option>
      <option value="2005">2005</option>
      <option value="2006">2006</option>
      <option value="2007">2007</option>
      <option value="2008">2008</option>
      <option value="2009">2009</option>
      <option value="2010">2010</option>
      <option value="2011">2011</option>
      <option value="2012">2012</option>
      <option value="2013">2013</option>
      <option value="2014">2014</option>
      <option value="2015">2015</option>
      <option value="2016">2016</option>
      <option value="2017">2017</option>
      <option value="2018">2018</option>
      <option value="2019">2019</option>
      <option value="2020">2020</option>
    </select>
	</p> 
    <p align=center>
	<select size="1" name="cmbMonth">
      <option value="01">1:Jan.</option>
      <option value="02">2:Feb.</option>
      <option value="03">3:Mar.</option>
      <option value="04">4:Apr.</option>
      <option value="05">5:May.</option>
      <option value="06">6:Jun.</option>
      <option value="07">7:Jul.</option>
      <option value="08">8:Aug.</option>
      <option value="09">9:Sep.</option>
      <option value="10">10:Oct.</option>
      <option value="11">11:Nov.</option>
      <option value="12">12:Dec.</option>
    </select>
	</p> 
    <p class="center"　>
	<select size="1" name="cmbWeek">
      <option value="1">Week1</option>
      <option value="2">Week2</option>
      <option value="3">Week3</option>
      <option value="4">Week4</option>
      <option value="5">Week5</option>
    </select>
	</p>
	<!--
    <p><font color="#FFFFFF">Mail宛先</font></p>
    <p align="center"><input type="text" name="txtMail" size="20"></p>
	-->
	<p align=center><input type=submit value=OK name=cmdFind>
	
	<div id="msg">
	
	</div>
</form>
</body>
</html>
